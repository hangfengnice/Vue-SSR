<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>string</title>
    <style>
      #btn {
        color: red;
      }
    </style>
  </head>
  <body>
    <button id='btn'>hello</button>
    <script>
      let str = "hello world hello hangfeng";

      function midString(str) {
        if (str.length > 15) {
          let head = str.substr(0, 6);
          let after = str.substr(-6);

          return head + "..." + after;
        }
        return str;
      }
      console.log(midString(str));

      function fileStr(str) {
        let length;
        str.replace(/\.\w+$/, function(match) {
          length = match.length + 1;
          return match;
        });
        let startLength = 15 - length - 3;

        return str.substr(0, startLength) + "..." + str.substr(-length);
      }
      fileStr("weixin_20191221232646.jpg");
      fileStr("weixin_201912212326.v46.jpeg");
      console.log(
        fileStr("weixin_20191221232646.jpg"),
        fileStr("weixin_201912212326.v46.jpeg")
      );

      function elsEmoji(str, len) {
        var t = len || 15;
        var emojiArr = str
          .replace(/â€”â€”|â€¦â€¦|[^\ud83c|\ud83d]/g, function($0) {
            if (/â€”â€”|â€¦â€¦/.test($0)) {
              return $0 + ",";
            }
            if (/[\u2000-\u2fff]/g.test($0)) {
              return $0;
            }
            return $0 + ",";
          })
          .slice(0, -1)
          .split(","); //è½¬åŒ–æˆæ•°ç»„ï¼Œä¸çŸ¥é“è¿™æ ·å…¨ä¸å…¨

        if (emojiArr.length >= t) {
          var reg = /\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]|[\u2000-\u2fff]|â€”â€”|â€¦â€¦|ï¼Œ|ï¼š|ï¼›/g;
          var mid = parseInt(emojiArr.length / 2);
          var before = emojiArr.slice(0, mid);
          var after = emojiArr.slice(mid);
          var index = 0;
          for (var i = 0; i < mid; i++) {
            if (reg.test(before[mid - i - 1])) {
              index = mid - i - 1;
              break;
            }
            if (reg.test(after[i])) {
              index = mid + i;
              break;
            }
          }

          var start = t - (emojiArr.length - index - 1) - 3;
          if (start <= 0 || index === emojiArr.length) {
            return elsMid(str);
          } else {
            return (
              emojiArr.slice(0, start).join("") +
              "..." +
              emojiArr.slice(index + 1).join("")
            );
          }
        }
        return str;
      }

      console.log(elsEmoji("ðŸŽ…ðŸŽ„ðŸŽâ¤ï¸ðŸš€ðŸš€ðŸš€åœ£è¯žå¿«ä¹ï¼Œç³»åˆ—æœ‰ðŸš€äº†"));
      console.log(elsEmoji("ðŸŽ…ðŸŽ„ðŸŽâ¤ï¸ðŸš€â¤ï¸åœ£è¯žå¿«ä¹ï¼Œç³»åˆ—æœ‰ðŸš€äº†"));
      console.log(elsEmoji("ðŸŽ…ðŸŽ„ðŸŽå¤§å®¶åœ£è¯žå¿«ä¹â€”â€”ç³»åˆ—æœ‰ðŸš€äº†"));
      console.log(elsEmoji("ðŸŽ…ðŸŽ„ðŸŽå¤§å®¶åœ£è¯žå¿«ä¹â¤ï¸ç³»åˆ—æœ‰ðŸš€äº†"));
      console.log(elsEmoji("ðŸŽ…ðŸŽ„ðŸŽå¤§å®¶åœ£è¯žå¿«ä¹â€¦â€¦ç³»åˆ—æœ‰ðŸš€äº†"));
    </script>
  </body>
</html>
